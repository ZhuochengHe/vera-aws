#!/bin/bash
export AWS_ACCESS_KEY_ID="test"
export AWS_SECRET_ACCESS_KEY="test"
export AWS_DEFAULT_REGION="${AWS_DEFAULT_REGION:-us-east-1}"

# Generate a provider override that points ec2 at the emulator
OVERRIDE="_vera_override.tf"
if [ ! -f "$OVERRIDE" ]; then
    cat > "$OVERRIDE" << 'INNER'
provider "aws" {
  skip_credentials_validation = true
  skip_metadata_api_check     = true
  skip_requesting_account_id  = true

  endpoints {
    ec2 = "http://localhost:5003"
  }
}
INNER
fi

terraform "$@"
